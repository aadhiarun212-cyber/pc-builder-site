<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PC Build Recommender</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body {
      margin: 0; min-height: 100vh; display: grid; place-items: center;
      background: #0b0b0f; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: #eee;
    }
    .card {
      width: min(92vw, 760px);
      border: 1px solid #222; background: #121218; border-radius: 16px; padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,.4);
    }
    h1 { margin: 0 0 8px; font-size: 1.4rem; }
    .muted { color: #9aa0a6; font-size: .9rem; }
    .grid { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; margin-top: 16px; }
    label { display: grid; gap: 6px; font-size: .9rem; color: #cbd5e1; }
    input, select, textarea {
      width: 100%; background: #0e0e14; border: 1px solid #242435; border-radius: 10px;
      color: #e5e7eb; padding: 10px 12px; outline: none;
    }
    textarea { min-height: 80px; }
    .row { display: flex; gap: 10px; align-items: center; margin-top: 12px; }
    button {
      background: #2563eb; border: 1px solid #1d4ed8; color: #fff; padding: 10px 14px;
      border-radius: 10px; cursor: pointer; font-weight: 600;
    }
    .ghost { background: transparent; border-color: #303042; color: #cbd5e1; }
    .status, .output {
      margin-top: 14px; background: #0f1117; border: 1px solid #22263a; border-radius: 12px; padding: 12px;
      min-height: 42px; white-space: pre-wrap;
    }
    a { color: #93c5fd; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ðŸ§  PC Build Recommender</h1>
    <div class="muted">Describe your build: pick game, target, and budget. Weâ€™ll normalize unrealistic combos automatically.</div>

    <div class="grid">
      <label>Game
        <select id="game">
          <option>Cyberpunk 2077</option>
          <option>Valorant</option>
          <option>CS2</option>
          <option>Overwatch 2</option>
          <option>Apex Legends</option>
          <option>Fortnite</option>
          <option>Rocket League</option>
          <option>Minecraft</option>
          <option>Roblox</option>
        </select>
      </label>

      <label>Setting
        <select id="setting">
          <option>1080p Low</option>
          <option>1080p Medium</option>
          <option selected>1080p High</option>
          <option>1440p High</option>
          <option>1440p Ultra</option>
          <option>4K High</option>
          <option>4K Ultra</option>
        </select>
      </label>

      <label>Budget
        <select id="budget">
          <option>$500â€“$1,000</option>
          <option>$1,000â€“$1,500</option>
          <option selected>$1,500â€“$2,000</option>
          <option>$2,000â€“$3,000</option>
          <option>$3,000+</option>
        </select>
      </label>

      <label>Extras (optional)
        <textarea id="extras" placeholder="e.g., prefer NVIDIA, quiet build, white theme"></textarea>
      </label>
    </div>

    <div class="row">
      <button id="go">Generate Build</button>
      <button id="clear" class="ghost">Clear</button>
    </div>

    <div class="status" id="status">Idle</div>
    <div class="output" id="out">Your build will appear here.</div>
  </div>

  <script>
    // ====== CONFIG ======
    // IMPORTANT: set this to your Render URL (no trailing slash)
    const API_BASE = "https://pc-builder-site.onrender.com"; // <-- CHANGE to your URL

    // ====== UI refs ======
    const gameEl   = document.getElementById('game');
    const settingEl= document.getElementById('setting');
    const budgetEl = document.getElementById('budget');
    const extrasEl = document.getElementById('extras');
    const goBtn    = document.getElementById('go');
    const clearBtn = document.getElementById('clear');
    const statusEl = document.getElementById('status');
    const outEl    = document.getElementById('out');

    // ====== guardrails (frontend) ======
    const MIN_BUDGET_FOR_SETTING = {
      "1080p Low": 500,
      "1080p Medium": 800,
      "1080p High": 1000,
      "1440p High": 1500,
      "1440p Ultra": 1800,
      "4K High": 2200,
      "4K Ultra": 3000,
    };
    function parseBudgetRange(label){
      const plus=/\$([\d,]+)\+\s*/i.exec(label);
      if(plus) return {min:Number(plus[1].replace(/,/g,"")),max:Infinity};
      const m=/\$([\d,]+)\s*â€“\s*\$([\d,]+)/i.exec(label);
      if(!m) return {min:0,max:0};
      return {min:Number(m[1].replace(/,/g,"")),max:Number(m[2].replace(/,/g,""))};
    }
    function normalizeChoice(setting,budgetLabel){
      const {min}=parseBudgetRange(budgetLabel);
      const required=MIN_BUDGET_FOR_SETTING[setting]??0;
      if(min<required){
        const BRACKETS=["$500â€“$1,000","$1,000â€“$1,500","$1,500â€“$2,000","$2,000â€“$3,000","$3,000+"];
        const pick = BRACKETS.find(b=>parseBudgetRange(b).min>=required) || "$3,000+";
        return {setting,budgetLabel:pick,note:`We raised the budget to meet "${setting}" (min ~$${required.toLocaleString()}).`};
      }
      return {setting,budgetLabel,note:""};
    }

    // ====== prompt builder ======
    function makePromptWithInputs({ game, setting, budgetLabel, extras }) {
      return `Build me a gaming PC for ${game} at ${setting}.
Budget: ${budgetLabel}.
Classify budget rules: 500â€“1000 = Low, 1000â€“2000 = Medium, 1800â€“3000 = High, 3300+ = 4K.
Return a neat list with: CPU, GPU, RAM (GB), Storage, PSU, Case, Est FPS for that game/setting, and Total price in USD.
${extras ? "Preferences: " + extras : ""}`;
    }

    // ====== linkify parts to PCPP search ======
    function linkifyParts(text){
      const LINES=text.split(/\r?\n/);
      const KEYS=["CPU","GPU","RAM","Memory","Storage","PSU","Power Supply","Case","Motherboard","Cooler"];
      return LINES.map(line=>{
        const m=/^(\s*)([A-Za-z ]{2,20}):\s*(.+)$/.exec(line);
        if(!m) return line;
        const[,indent,key,value]=m;
        if(!KEYS.includes(key.trim())) return line;
        const q=encodeURIComponent(value.replace(/\*|\[.*?\]|\(.*?\)/g,"").trim());
        const href=`https://pcpartpicker.com/search/?q=${q}`;
        return `${indent}${key}: <a href="${href}" target="_blank" rel="noopener noreferrer">${value}</a>`;
      }).join("\n");
    }

    // ====== backend call ======
    async function askBackend(message){
      const resp = await fetch(`${API_BASE}/ask`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ message })
      });
      if(!resp.ok){
        const txt = await resp.text().catch(()=> "");
        throw new Error(`Request failed (${resp.status}). ${txt}`);
      }
      const data = await resp.json();
      return data.answer || JSON.stringify(data);
    }

    // ====== handlers ======
    async function onGenerate(){
      let setting = settingEl.value;
      let budgetLabel = budgetEl.value;

      const norm = normalizeChoice(setting, budgetLabel);
      setting = norm.setting; budgetLabel = norm.budgetLabel;

      statusEl.textContent = norm.note || "Workingâ€¦";
      outEl.textContent = "";
      goBtn.disabled = true;

      const prompt = makePromptWithInputs({
        game: gameEl.value,
        setting, budgetLabel,
        extras: extrasEl.value
      });

      try{
        const answer = await askBackend(prompt);
        outEl.innerHTML = linkifyParts(answer).replace(/\n/g,"<br>");
        statusEl.textContent = norm.note ? `${norm.note} Done.` : "Done";
      }catch(err){
        statusEl.textContent = "Error";
        alert(err.message);
      }finally{
        goBtn.disabled = false;
      }
    }
    function onClear(){
      extrasEl.value=""; outEl.textContent="Your build will appear here."; statusEl.textContent="Idle";
    }

    goBtn.addEventListener("click", onGenerate);
    clearBtn.addEventListener("click", onClear);
  </script>
</body>
</html>

